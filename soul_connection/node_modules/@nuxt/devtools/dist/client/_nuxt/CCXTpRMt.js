import{d as O,ao as ae,bS as oe,P as se,r as U,Q as E,bT as F,aE as le,w as re,aD as ue,a1 as ie,a as de,L as f,M as h,f as t,o as l,h as _,j as u,k as r,i as c,l as M,m as i,F as x,n as A,t as k,G as R,ae as L,v as d,p as z,ay as ce,I as pe,bj as _e,af as me,bU as G,_ as fe,X as ve,a6 as ye,at as ge,A as he,U as ke,aK as be}from"./C_tLznPO.js";import{_ as xe}from"./BiRcA7Ly.js";import{_ as we}from"./Dm9RYIcI.js";import{_ as Ce}from"./BI3hykgO.js";import{e as Ke}from"./B3uNdhXb.js";const Se={class:"h-[48px] flex items-center justify-between gap1 px-3"},Ve={class:"w-full text-sm"},$e=["value"],Ne=["onClick"],Ie=r("div",{"x-divider":""},null,-1),je={key:0,"h-full":"","of-hidden":"",flex:"~ col"},De={border:"b base",class:"h-[49px] flex flex-none items-center justify-between px-4 text-sm"},Ue={class:"flex items-center gap-4"},Me={key:1},Ae=["onKeyup"],Le=r("br",null,null,-1),Be={key:0,op50:""},Pe={key:1},Te=r("code",null,"nitro.storage",-1),qe=r("br",null,null,-1),Ee={"font-bold":""},Fe=r("br",null,null,-1),Re={"text-sm":""},ze=r("br",null,null,-1),Ge=O({__name:"StorageDetails",async setup(Q){let p,g;const w=ae(),C=oe(),K=se(),b=U(""),v=U(""),s=E("storage:current",""),e=U(),y=E("storage:file:state",""),{data:S}=([p,g]=F(()=>G("storageMounts",()=>f.getStorageMounts())),p=await p,g(),p),{data:V,refresh:B}=([p,g]=F(async()=>G("storageKeys",async()=>s.value?await f.getStorageKeys(s.value):[])),p=await p,g(),p),W=C.hook("storage:key:update",async(n,a)=>{if(!(!s.value||n.split(":")[0]!==s.value)&&(await B(),y.value===n)){if(a==="remove")return K.replace({query:{storage:s.value}});await N(y.value)}});le(W),re(s,()=>{B(),y.value=""}),ue(async()=>{if(!y.value){e.value=null;return}N(y.value)}),ie("keydown",n=>{n.key==="s"&&(n.ctrlKey||n.metaKey)&&(I(),n.preventDefault())});function $(n){return n.replace(`${s.value}:`,"")}const X=de(()=>V.value?V.value.filter(n=>n.includes(b.value)):[]);async function N(n){const a=await f.getStorageItem(await h(),n);e.value={key:n,updatedKey:$(n),editingKey:!1,content:a,updatedContent:a}}async function H(){if(!v.value||!s.value)return;const n=`${s.value}:${v.value}`;V.value?.includes(n)||await f.setStorageItem(await h(),n,""),K.replace({query:{storage:s.value,key:n}}),v.value=""}async function I(){e.value&&(await f.setStorageItem(await h(),e.value.key,e.value.updatedContent),await N(e.value.key))}async function J(){!e.value||!s.value||(await f.removeStorageItem(await h(),e.value.key),e.value=null)}async function Y(){if(!e.value||!s.value)return;const n=`${s.value}:${e.value.updatedKey}`,a=await h();await f.setStorageItem(a,n,e.value.updatedContent),await f.removeStorageItem(a,e.value.key),K.replace({query:{storage:s.value,key:n}})}return(n,a)=>{const j=fe,Z=xe,D=ve,ee=ye,P=we,T=ge,q=he,te=ke,ne=Ce;return t(s)?(l(),_(te,{key:0,"storage-key":"tab-storage"},{left:u(()=>[r("div",Se,[c(j,{icon:"carbon-chevron-left","ml--1":"",border:!1,onClick:a[0]||(a[0]=o=>s.value="")}),r("div",Ve,[c(Z,{modelValue:t(s),"onUpdate:modelValue":a[1]||(a[1]=o=>M(s)?s.value=o:null),n:"primary",icon:"carbon-data-base"},{default:u(()=>[(l(!0),i(x,null,A(t(S),(o,m)=>(l(),i("option",{key:m,value:m},k(m),9,$e))),128))]),_:1},8,["modelValue"])])]),c(D,{modelValue:t(b),"onUpdate:modelValue":a[2]||(a[2]=o=>M(b)?b.value=o:null),icon:"carbon-search",placeholder:"Search...",n:"primary sm",border:"y x-none base! rounded-0",class:"w-full py2 ring-0!"},null,8,["modelValue"]),(l(!0),i(x,null,A(t(X),o=>(l(),i(x,{key:o},[r("button",{block:"","w-full":"",truncate:"",px2:"",py1:"","text-start":"","text-sm":"","font-mono":"",class:R(o===t(e)?.key?"text-primary n-bg-active":"text-secondary hover:n-bg-hover"),onClick:m=>y.value=o},k($(o)),11,Ne),Ie],64))),128)),c(D,{modelValue:t(v),"onUpdate:modelValue":a[3]||(a[3]=o=>M(v)?v.value=o:null),icon:"carbon-add",placeholder:"key",n:"sm",border:"t-none x-none base! rounded-0",class:"w-full py2 font-mono ring-0!",onKeyup:L(H,["enter"])},null,8,["modelValue"])]),right:u(()=>[t(e)?.key?(l(),i("div",je,[r("div",De,[r("div",Ue,[t(e).editingKey?(l(),_(D,{key:0,modelValue:t(e).updatedKey,"onUpdate:modelValue":a[4]||(a[4]=o=>t(e).updatedKey=o),onKeyup:L(Y,["enter"])},null,8,["modelValue"])):(l(),i("code",Me,[d(k($(t(e).key))+" ",1),c(ee,{icon:"carbon-edit",class:"cursor-pointer op50 hover:op100",onClick:a[5]||(a[5]=o=>t(e).editingKey=!0)})])),t(e).editingKey?z("",!0):(l(),_(j,{key:2,n:"green xs",disabled:t(e).content===t(e).updatedContent,class:R({"border-green":t(e).content!==t(e).updatedContent}),onClick:I},{default:u(()=>[d(" Save ")]),_:1},8,["disabled","class"]))]),r("div",null,[c(j,{n:"red xs",onClick:J},{default:u(()=>[d(" Delete ")]),_:1})])]),typeof t(e).content=="object"?(l(),_(t(Ke),ce({key:0,modelValue:t(e).updatedContent,"onUpdate:modelValue":a[6]||(a[6]=o=>t(e).updatedContent=o),class:[[t(w)==="dark"?"jse-theme-dark":"light"],"json-editor-vue h-full of-auto text-sm outline-none"]},n.$attrs,{mode:"text","navigation-bar":!1,indentation:2,"tab-size":2}),null,16,["modelValue","class"])):pe((l(),i("textarea",{key:1,"onUpdate:modelValue":a[7]||(a[7]=o=>t(e).updatedContent=o),placeholder:"Item value...",class:"h-full of-auto p-4 text-sm font-mono outline-none",onKeyup:L(_e(I,["ctrl"]),["enter"])},null,40,Ae)),[[me,t(e).updatedContent]])])):(l(),_(q,{key:1},{default:u(()=>[c(T,{px6:"",py4:""},{default:u(()=>[d(" Select one key to start."),Le,d("Learn more about "),c(P,{href:"https://nitro.unjs.io/guide/storage",n:"orange",target:"_blank"},{default:u(()=>[d(" Nitro storage ")]),_:1})]),_:1})]),_:1}))]),_:1})):(l(),_(q,{key:1},{default:u(()=>[Object.keys(t(S)).length?(l(),i("p",Be," Select one storage to start: ")):(l(),i("p",Pe,[d(" No custom storage defined in "),Te,d("."),qe,d(" Learn more about "),c(P,{href:"https://nitro.unjs.io/guide/storage",n:"orange",target:"_blank"},{default:u(()=>[d(" Nitro storage ")]),_:1})])),(l(!0),i(x,null,A(t(S),(o,m)=>(l(),_(T,{key:m,"min-w-80":"","cursor-pointer":"","p-4":"","text-left":"",hover:"border-green",onClick:Oe=>s.value=m},{default:u(()=>[r("span",Ee,k(m),1),Fe,r("span",Re,k(o.driver)+" driver",1),ze,o.base?(l(),_(ne,{key:0,"text-xs":"",filepath:o.base},null,8,["filepath"])):z("",!0)]),_:2},1032,["onClick"]))),128))]),_:1}))}}}),Ye=O({__name:"storage",setup(Q){return(p,g)=>{const w=Ge,C=be;return l(),_(C,null,{default:u(()=>[c(w)]),_:1})}}});export{Ye as default};
